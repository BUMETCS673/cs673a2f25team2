<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>健康管理 - 用户管理系统测试</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7fb; margin:0; }
    .container { max-width: 1200px; margin: 40px auto; padding: 24px; background:#fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    h1 { margin:0 0 16px; font-size: 22px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .card { padding:16px; border:1px solid #e8eaf0; border-radius: 10px; background:#fafbff; }
    label { display:block; font-size: 13px; color:#4b5563; margin:10px 0 6px; }
    input, select { width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius: 8px; outline:none; font-size:14px; }
    input:focus, select:focus { border-color:#6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,.15); }
    button { background:#6366f1; color:#fff; border:none; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; margin-top:12px; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    button.secondary { background:#6b7280; }
    button.success { background:#059669; }
    button.danger { background:#dc2626; }
    .result { margin-top:12px; background:#111827; color:#e5e7eb; padding:12px; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:13px; white-space: pre-wrap; word-break: break-word; }
    .ok { color:#059669; font-weight:600; }
    .err { color:#dc2626; font-weight:600; }
    .hint { font-size:12px; color:#6b7280; margin-top:6px; }
    .section { margin-bottom: 30px; }
    .section h2 { margin: 0 0 16px; font-size: 18px; color: #374151; }
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1>健康管理 - 用户管理系统测试</h1>
    
    <div class="section">
      <h2>用户认证</h2>
      <div class="grid">
        <div class="card">
          <h3>注册</h3>
          <label>用户名</label>
          <input v-model="registerForm.username" placeholder="例如：alice" />
          <label>密码</label>
          <input v-model="registerForm.password" type="password" placeholder="至少6位" />
          <label>邮箱</label>
          <input v-model="registerForm.email" placeholder="alice@example.com" />
          <label>姓名</label>
          <input v-model="registerForm.fullName" placeholder="Alice Smith" />
          <button :disabled="busy" @click="register">提交注册</button>
          <div class="hint">POST /api/auth/register</div>
          <div class="result" v-if="registerResult">
            <div v-if="registerResult.ok" class="ok">注册成功</div>
            <div v-else class="err">注册失败</div>
            <pre>{{ pretty(registerResult.data) }}</pre>
          </div>
        </div>

        <div class="card">
          <h3>登录</h3>
          <label>用户名</label>
          <input v-model="loginForm.username" placeholder="与注册一致" />
          <label>密码</label>
          <input v-model="loginForm.password" type="password" />
          <button :disabled="busy" @click="login">提交登录</button>
          <div class="hint">POST /api/auth/login</div>
          <div class="result" v-if="loginResult">
            <div v-if="loginResult.ok" class="ok">登录成功</div>
            <div v-else class="err">登录失败</div>
            <pre>{{ pretty(loginResult.data) }}</pre>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Google登录 & 密码管理</h2>
      <div class="grid">
        <div class="card">
          <h3>Google登录</h3>
          <label>Google ID</label>
          <input v-model="googleForm.googleId" placeholder="123456789" />
          <label>邮箱</label>
          <input v-model="googleForm.email" placeholder="user@gmail.com" />
          <label>姓名</label>
          <input v-model="googleForm.fullName" placeholder="John Doe" />
          <label>头像URL</label>
          <input v-model="googleForm.avatar" placeholder="https://..." />
          <button :disabled="busy" @click="googleLogin">Google登录</button>
          <div class="hint">POST /api/auth/google-login</div>
          <div class="result" v-if="googleResult">
            <div v-if="googleResult.ok" class="ok">Google登录成功</div>
            <div v-else class="err">Google登录失败</div>
            <pre>{{ pretty(googleResult.data) }}</pre>
          </div>
        </div>

        <div class="card">
          <h3>修改密码</h3>
          <label>用户ID</label>
          <input v-model="passwordForm.userId" placeholder="1" />
          <label>旧密码</label>
          <input v-model="passwordForm.oldPassword" type="password" />
          <label>新密码</label>
          <input v-model="passwordForm.newPassword" type="password" />
          <button :disabled="busy" @click="changePassword">修改密码</button>
          <div class="hint">POST /api/auth/change-password</div>
          <div class="result" v-if="passwordResult">
            <div v-if="passwordResult.ok" class="ok">密码修改成功</div>
            <div v-else class="err">密码修改失败</div>
            <pre>{{ pretty(passwordResult.data) }}</pre>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>用户信息管理</h2>
      <div class="grid">
        <div class="card">
          <h3>更新用户信息</h3>
          <label>用户ID</label>
          <input v-model="profileForm.userId" placeholder="1" />
          <label>邮箱</label>
          <input v-model="profileForm.email" placeholder="new@example.com" />
          <label>姓名</label>
          <input v-model="profileForm.fullName" placeholder="New Name" />
          <label>年龄</label>
          <input v-model="profileForm.age" type="number" placeholder="25" />
          <label>性别</label>
          <select v-model="profileForm.gender">
            <option value="">请选择</option>
            <option value="MALE">男</option>
            <option value="FEMALE">女</option>
            <option value="OTHER">其他</option>
          </select>
          <label>电话</label>
          <input v-model="profileForm.phone" placeholder="13800138000" />
          <button :disabled="busy" @click="updateProfile">更新信息</button>
          <div class="hint">POST /api/auth/update-profile</div>
          <div class="result" v-if="profileResult">
            <div v-if="profileResult.ok" class="ok">信息更新成功</div>
            <div v-else class="err">信息更新失败</div>
            <pre>{{ pretty(profileResult.data) }}</pre>
          </div>
        </div>

        <div class="card">
          <h3>用户管理</h3>
          <button :disabled="busy" @click="getAllUsers">获取所有用户</button>
          <button :disabled="busy" @click="getUserById">根据ID获取用户</button>
          <div class="hint">GET /api/users & GET /api/users/{id}</div>
          <div class="result" v-if="userManagementResult">
            <div v-if="userManagementResult.ok" class="ok">操作成功</div>
            <div v-else class="err">操作失败</div>
            <pre>{{ pretty(userManagementResult.data) }}</pre>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>角色权限管理</h2>
      <div class="grid-3">
        <div class="card">
          <h3>角色管理</h3>
          <button :disabled="busy" @click="getAllRoles">获取所有角色</button>
          <button :disabled="busy" @click="createRole">创建角色</button>
          <div class="hint">GET /api/roles & POST /api/roles</div>
          <div class="result" v-if="roleResult">
            <div v-if="roleResult.ok" class="ok">操作成功</div>
            <div v-else class="err">操作失败</div>
            <pre>{{ pretty(roleResult.data) }}</pre>
          </div>
        </div>

        <div class="card">
          <h3>用户角色</h3>
          <label>用户ID</label>
          <input v-model="userRoleForm.userId" placeholder="1" />
          <label>角色ID</label>
          <input v-model="userRoleForm.roleId" placeholder="1" />
          <button :disabled="busy" @click="assignRoleToUser">分配角色</button>
          <button :disabled="busy" @click="getUserRoles">获取用户角色</button>
          <div class="hint">POST /api/users/{id}/roles</div>
          <div class="result" v-if="userRoleResult">
            <div v-if="userRoleResult.ok" class="ok">操作成功</div>
            <div v-else class="err">操作失败</div>
            <pre>{{ pretty(userRoleResult.data) }}</pre>
          </div>
        </div>

        <div class="card">
          <h3>权限管理</h3>
          <button :disabled="busy" @click="getAllPermissions">获取所有权限</button>
          <button :disabled="busy" @click="getUserPermissions">获取用户权限</button>
          <div class="hint">GET /api/permissions & GET /api/users/{id}/permissions</div>
          <div class="result" v-if="permissionResult">
            <div v-if="permissionResult.ok" class="ok">操作成功</div>
            <div v-else class="err">操作失败</div>
            <pre>{{ pretty(permissionResult.data) }}</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          busy: false,
          registerForm: { username: '', password: '', email: '', fullName: '' },
          loginForm: { username: '', password: '' },
          googleForm: { googleId: '', email: '', fullName: '', avatar: '' },
          passwordForm: { userId: '', oldPassword: '', newPassword: '' },
          profileForm: { userId: '', email: '', fullName: '', age: '', gender: '', phone: '' },
          userRoleForm: { userId: '', roleId: '' },
          registerResult: null,
          loginResult: null,
          googleResult: null,
          passwordResult: null,
          profileResult: null,
          userManagementResult: null,
          roleResult: null,
          userRoleResult: null,
          permissionResult: null
        };
      },
      methods: {
        pretty(obj) {
          try { return JSON.stringify(obj, null, 2); } catch { return String(obj); }
        },
        async register() {
          this.busy = true;
          this.registerResult = null;
          try {
            const res = await fetch('/api/auth/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.registerForm)
            });
            const data = await res.json().catch(() => ({}));
            this.registerResult = { ok: res.ok, data };
          } catch (e) {
            this.registerResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async login() {
          this.busy = true;
          this.loginResult = null;
          try {
            const res = await fetch('/api/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.loginForm)
            });
            const data = await res.json().catch(() => ({}));
            this.loginResult = { ok: res.ok, data };
          } catch (e) {
            this.loginResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async googleLogin() {
          this.busy = true;
          this.googleResult = null;
          try {
            const res = await fetch('/api/auth/google-login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.googleForm)
            });
            const data = await res.json().catch(() => ({}));
            this.googleResult = { ok: res.ok, data };
          } catch (e) {
            this.googleResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async changePassword() {
          this.busy = true;
          this.passwordResult = null;
          try {
            const res = await fetch('/api/auth/change-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.passwordForm)
            });
            const data = await res.json().catch(() => ({}));
            this.passwordResult = { ok: res.ok, data };
          } catch (e) {
            this.passwordResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async updateProfile() {
          this.busy = true;
          this.profileResult = null;
          try {
            const payload = { ...this.profileForm };
            if (payload.age) payload.age = parseInt(payload.age);
            const res = await fetch('/api/auth/update-profile', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            const data = await res.json().catch(() => ({}));
            this.profileResult = { ok: res.ok, data };
          } catch (e) {
            this.profileResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getAllUsers() {
          this.busy = true;
          this.userManagementResult = null;
          try {
            const res = await fetch('/api/users');
            const data = await res.json().catch(() => ({}));
            this.userManagementResult = { ok: res.ok, data };
          } catch (e) {
            this.userManagementResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getUserById() {
          this.busy = true;
          this.userManagementResult = null;
          try {
            const res = await fetch(`/api/users/${this.profileForm.userId}`);
            const data = await res.json().catch(() => ({}));
            this.userManagementResult = { ok: res.ok, data };
          } catch (e) {
            this.userManagementResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getAllRoles() {
          this.busy = true;
          this.roleResult = null;
          try {
            const res = await fetch('/api/roles');
            const data = await res.json().catch(() => ({}));
            this.roleResult = { ok: res.ok, data };
          } catch (e) {
            this.roleResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async createRole() {
          this.busy = true;
          this.roleResult = null;
          try {
            const res = await fetch('/api/roles', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ name: 'TEST_ROLE', description: 'Test Role' })
            });
            const data = await res.json().catch(() => ({}));
            this.roleResult = { ok: res.ok, data };
          } catch (e) {
            this.roleResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async assignRoleToUser() {
          this.busy = true;
          this.userRoleResult = null;
          try {
            const res = await fetch(`/api/users/${this.userRoleForm.userId}/roles`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ roleId: parseInt(this.userRoleForm.roleId) })
            });
            const data = await res.json().catch(() => ({}));
            this.userRoleResult = { ok: res.ok, data };
          } catch (e) {
            this.userRoleResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getUserRoles() {
          this.busy = true;
          this.userRoleResult = null;
          try {
            const res = await fetch(`/api/users/${this.userRoleForm.userId}/roles`);
            const data = await res.json().catch(() => ({}));
            this.userRoleResult = { ok: res.ok, data };
          } catch (e) {
            this.userRoleResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getAllPermissions() {
          this.busy = true;
          this.permissionResult = null;
          try {
            const res = await fetch('/api/permissions');
            const data = await res.json().catch(() => ({}));
            this.permissionResult = { ok: res.ok, data };
          } catch (e) {
            this.permissionResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        },
        async getUserPermissions() {
          this.busy = true;
          this.permissionResult = null;
          try {
            const res = await fetch(`/api/users/${this.userRoleForm.userId}/permissions`);
            const data = await res.json().catch(() => ({}));
            this.permissionResult = { ok: res.ok, data };
          } catch (e) {
            this.permissionResult = { ok: false, data: { error: e.message } };
          } finally {
            this.busy = false;
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>



